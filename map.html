<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Map - Timeline Overwatch</title>
    <link rel="icon" type="image/png" href="Icon.png">
    <link rel="stylesheet" href="styles.css?v=4">
    <script>
        // Asset loading order tracking for map.html
        console.log('[0.00ms] PAGE: map.html');
        console.log('[0.00ms] HTML: Document structure parsed');
        console.log('[0.00ms] CSS: styles.css (linked in <head>)');
        console.log('[0.00ms] ICON: Icon.png (favicon)');
        
        // Auto-generate manifest before page loads
        // Note: Browsers can't run Node.js directly, so this is a reminder
        // For automatic generation, use: npm run generate (or node generate-manifest.js)
        window.addEventListener('DOMContentLoaded', function() {
            console.log('[DOM] DOMContentLoaded event fired');
            console.log('Tip: Run "node generate-manifest.js" after adding/removing files');
            // Try to load manifest with cache busting
            fetch('manifest.json?' + Date.now(), { cache: 'no-store' })
                .then(() => console.log('[MANIFEST] manifest.json loaded with cache busting'))
                .catch(() => console.log('[MANIFEST] Manifest not found - run generate-manifest.js'));
        });
        
        // Log when scripts start loading
        window.addEventListener('load', function() {
            console.log('[LOAD] window.load event fired - all resources loaded');
            console.log('[SCRIPTS] Three.js library (CDN)');
            console.log('[SCRIPTS] GLTFLoader.js (CDN)');
            console.log('[SCRIPTS] globe-new.js (module)');
            console.log('[SCRIPTS] EventManager.js');
            console.log('[SCRIPTS] script.js');
            console.log('[IMAGES] Rotation Icon.png');
            console.log('[IMAGES] Train Icon.png');
            console.log('[IMAGES] Event Manager Icon.png');
            console.log('[IMAGES] Filter Icon.png');
            console.log('[IMAGES] Music Icon.png');
            console.log('[IMAGES] Palette Icon.png');
            console.log('[IMAGES] Pause Icon.png, Skip Icon.png, Unmuted Icon.png, Shuffle Icon.png');
        });
    </script>
</head>
<body>
    <header>
        <h1>Timeline Overwatch</h1>
    </header>

    <div class="layout-container">
        <main id="content">
            <div id="globe-container"></div>
            
            <!-- Globe Control Buttons -->
            <button id="autoRotateToggle" class="globe-control-btn" title="Toggle Auto-Rotation">
                <span id="rotateIcon">
                    <img src="Rotation Icon.png" alt="Rotate" style="width: 100%; height: 100%; object-fit: contain;">
                </span>
            </button>
            
            <button id="hyperloopToggle" class="globe-control-btn hyperloop-btn active" title="Toggle Transport Systems">
                <span id="hyperloopIcon">
                    <img src="Train Icon.png" alt="Transport" style="width: 100%; height: 100%; object-fit: contain;">
                </span>
            </button>
            
            <button id="eventsManageToggle" class="globe-control-btn events-manage-btn top-left-btn" title="Manage Events">
                <span id="eventsManageIcon">
                    <img src="Event Manager Icon.png" alt="Event Manager" style="width: 100%; height: 100%; object-fit: contain;">
                </span>
            </button>
            
            <button id="filtersToggle" class="globe-control-btn filters-btn top-left-btn" title="Open Filters">
                <span id="filtersIcon">
                    <img src="Filter Icon.png" alt="Filters" style="width: 100%; height: 100%; object-fit: contain;">
                </span>
            </button>
            
            <button id="musicToggle" class="globe-control-btn music-btn bottom-right-btn" title="Music Options">
                <span id="musicIcon">
                    <img src="Music Icon.png" alt="Music" style="width: 100%; height: 100%; object-fit: contain;">
                </span>
            </button>
            
            <!-- Color Palette Toggle Button (bottom right) -->
            <button id="colorPaletteToggle" class="globe-control-btn color-palette-btn bottom-right-btn" title="Toggle Color Palette">
                <span id="colorPaletteIcon">
                    <img src="Palette Icon.png" alt="Color Palette" style="width: 100%; height: 100%; object-fit: contain;">
                </span>
            </button>
            
            <!-- Event Pagination Controls -->
            <div class="event-pagination" id="eventPagination">
                <div class="page-controls-row">
                    <button id="prevPageBtn" class="page-btn" title="Previous Page">‚Äπ</button>
                    <div class="page-input-container">
                        <span class="page-label">Page</span>
                        <input type="number" id="pageInput" class="page-input" min="1" value="1" title="Enter page number">
                        <span class="page-total" id="pageTotal">/ 1</span>
                    </div>
                    <button id="nextPageBtn" class="page-btn" title="Next Page">‚Ä∫</button>
                </div>
                <div class="event-number-buttons" id="eventNumberButtons">
                    <button class="event-number-btn" data-position="1" title="Event 1">1</button>
                    <button class="event-number-btn" data-position="2" title="Event 2">2</button>
                    <button class="event-number-btn" data-position="3" title="Event 3">3</button>
                    <button class="event-number-btn" data-position="4" title="Event 4">4</button>
                    <button class="event-number-btn" data-position="5" title="Event 5">5</button>
                    <button class="event-number-btn" data-position="6" title="Event 6">6</button>
                    <button class="event-number-btn" data-position="7" title="Event 7">7</button>
                    <button class="event-number-btn" data-position="8" title="Event 8">8</button>
                    <button class="event-number-btn" data-position="9" title="Event 9">9</button>
                    <button class="event-number-btn" data-position="10" title="Event 10">10</button>
                </div>
            </div>
        </main>

        <nav class="sidebar" id="sidebar">
            <div class="sidebar-close" id="sidebarClose">&times;</div>
            <button onclick="window.location.href='map.html'" class="active">Map</button>
            <button onclick="window.location.href='test.html'">Test</button>
            <button onclick="window.location.href='main.html'">Main</button>
        </nav>

        <!-- Event Slide Panel (left side) -->
        <div class="event-slide" id="eventSlide">
            <div class="event-slide-close" id="eventSlideClose">&times;</div>
            <div class="event-slide-content" id="eventSlideContent">
                <div class="event-slide-scrollable" id="eventSlideScrollable">
                    <div id="eventVariantToggles" style="display: none; margin-bottom: 15px; display: flex; gap: 8px; flex-wrap: wrap;"></div>
                    <h2 id="eventSlideTitle">Event</h2>
                    <p id="eventSlideLocation" class="event-slide-location" style="display: none;"></p>
                    <p id="eventSlideText">Placeholder text for event information.</p>
                </div>
                <div class="event-slide-bottom" id="eventSlideBottom">
                    <div class="event-sources-section" id="eventSourcesSection" style="display: none;">
                        <h4 class="event-filter-header">Sources:</h4>
                        <div class="event-sources-list" id="eventSourcesList"></div>
                    </div>
                    <div class="event-filters-section" id="eventFiltersSection" style="display: none;">
                        <div class="event-filters-list" id="eventFiltersList"></div>
                    </div>
                    <div class="event-control-buttons">
                        <button id="eventImageToggle" class="event-image-toggle-btn">Show Image</button>
                        <button id="eventGlitchToggle" class="event-glitch-toggle-btn" style="display: none;">Enable Glitch</button>
                    </div>
                    <div class="event-navigation-buttons">
                        <button id="eventPrevBtn" class="event-nav-btn" title="Previous Event">‚Äπ</button>
                        <button id="eventAllEventsBtn" class="event-all-events-btn" title="View All Events">All Events</button>
                        <button id="eventNextBtn" class="event-nav-btn" title="Next Event">‚Ä∫</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Event Image Overlay (over globe) -->
        <div class="event-image-overlay" id="eventImageOverlay">
            <div class="event-image-container" id="eventImageContainer">
                <img id="eventImage" src="" alt="Event Image" style="display: none;">
            </div>
        </div>

        <!-- Filters Panel (right side) -->
        <div class="filters-panel" id="filtersPanel">
            <div class="filters-panel-close" id="filtersPanelClose">&times;</div>
            <div class="filters-panel-content">
                <div class="filters-actions">
                    <h2 class="filters-title">Filters</h2>
                    <div class="filters-actions-buttons">
                        <button id="clearFiltersBtn" class="filters-action-btn">Clear</button>
                        <button id="confirmFiltersBtn" class="filters-action-btn filters-confirm-btn">Confirm</button>
                    </div>
                </div>
                <div class="filters-tabs">
                    <button id="heroesTab" class="filter-tab active">
                        Heroes
                        <span class="filter-count" id="heroesCount">0</span>
                    </button>
                    <button id="factionsTab" class="filter-tab">
                        Factions
                        <span class="filter-count" id="factionsCount">0</span>
                    </button>
                </div>
                <div class="filters-grid" id="filtersGrid">
                    <!-- Filter buttons will be dynamically generated here -->
                </div>
            </div>
        </div>

        <!-- Music Options Panel (right side, below filters) -->
        <div class="music-panel" id="musicPanel">
            <div class="music-panel-close" id="musicPanelClose">&times;</div>
            <div class="music-panel-content">
                <div class="music-actions">
                    <h2 class="music-title">Music Options</h2>
                    <div class="music-actions-buttons">
                        <!-- Buttons moved to under progress bar -->
                    </div>
                </div>
                <div class="music-now-playing" id="musicNowPlaying">
                    <div class="music-current-song" id="musicCurrentSong">Loading...</div>
                    <div class="music-progress-container">
                        <input type="range" id="musicProgressBar" class="music-progress-bar" min="0" max="100" value="0">
                        <div class="music-time-display">
                            <span id="musicCurrentTime">0:00</span> <span id="musicTotalTime">0:00</span>
                        </div>
                        <div class="music-control-buttons">
                            <button id="pauseBtn" class="music-control-btn">
                                <img id="pauseBtnIcon" src="Pause Icon.png" alt="Pause" class="control-icon">
                            </button>
                            <button id="skipBtn" class="music-control-btn">
                                <img id="skipBtnIcon" src="Skip Icon.png" alt="Skip" class="control-icon">
                            </button>
                            <button id="muteBtn" class="music-control-btn">
                                <img id="muteBtnIcon" src="Unmuted Icon.png" alt="Mute" class="control-icon">
                            </button>
                            <button id="shuffleBtn" class="music-control-btn">
                                <img id="shuffleBtnIcon" src="Shuffle Icon.png" alt="Shuffle" class="control-icon">
                            </button>
                        </div>
                    </div>
                </div>
                <div class="music-control-row">
                    <label for="volumeSlider">Music Volume:</label>
                    <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="10">
                    <span id="volumeValue" class="volume-value">10%</span>
                </div>
                <div class="music-control-row">
                    <label for="soundEffectsSlider">Sound Effects Volume:</label>
                    <input type="range" id="soundEffectsSlider" class="volume-slider" min="0" max="100" value="50">
                    <span id="soundEffectsVolumeValue" class="volume-value">50%</span>
                </div>
                <div class="music-grid" id="musicGrid">
                    <!-- Music buttons will be dynamically generated here -->
                </div>
            </div>
        </div>
        
        <!-- Event Management Panel -->
        <div class="events-manage-panel" id="eventsManagePanel">
            <div class="events-manage-close" id="eventsManageClose">&times;</div>
            <div class="events-manage-content">
                <div class="events-manage-header">
                    <div class="events-manage-title-section">
                        <h2 class="events-manage-title">Event Management</h2>
                        <p class="events-manage-count" id="eventsCount">0 Events</p>
                    </div>
                    <div class="events-manage-actions">
                        <button id="addEventBtn" class="events-manage-action-btn">+ Add Event</button>
                        <button id="saveEventsBtn" class="events-manage-action-btn save-btn">üíæ Save</button>
                        <button id="exportEventsBtn" class="events-manage-action-btn export-btn">üì• Export</button>
                    </div>
                </div>
                <div class="events-list" id="eventsList">
                    <!-- Events will be dynamically generated here -->
                </div>
            </div>
        </div>
        
        <!-- Event Edit Modal -->
        <div class="event-edit-modal" id="eventEditModal">
            <div class="event-edit-modal-content">
                <div class="event-edit-modal-header">
                    <h3 id="eventEditModalTitle">Edit Event</h3>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div id="eventVariantTabs" style="display: flex; gap: 8px; flex-wrap: wrap;"></div>
                        <button class="event-edit-modal-close" id="eventEditModalClose">&times;</button>
                    </div>
                </div>
                <div class="event-edit-form">
                    <div class="event-edit-field event-edit-field-full">
                        <label for="eventEditName">Event Title:</label>
                        <input type="text" id="eventEditName" class="event-edit-input" autocomplete="off" required>
                    </div>
                    <div class="event-edit-field event-edit-field-full">
                        <label for="eventEditCity">City Name (for location lookup):</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="eventEditCity" class="event-edit-input" autocomplete="off" style="flex: 1;">
                            <label style="display: flex; align-items: center; gap: 5px; white-space: nowrap; font-size: 12px;">
                                <input type="checkbox" id="useCodeLookup">
                                Use Code Lookup
                            </label>
                        </div>
                        <button type="button" id="lookupCityBtn" class="lookup-city-btn">üîç Lookup</button>
                    </div>
                    <div class="event-edit-field event-edit-field-full">
                        <label for="eventEditCityDisplayName">City Display Name (shown in preview and info panel):</label>
                        <input type="text" id="eventEditCityDisplayName" class="event-edit-input" autocomplete="off">
                    </div>
                    <div class="event-edit-field">
                        <label for="eventEditLat">Latitude:</label>
                        <input type="number" id="eventEditLat" class="event-edit-input" autocomplete="off" step="any" required>
                    </div>
                    <div class="event-edit-field">
                        <label for="eventEditLon">Longitude:</label>
                        <input type="number" id="eventEditLon" class="event-edit-input" autocomplete="off" step="any" required>
                    </div>
                    <div class="event-edit-field event-edit-field-full">
                        <label for="eventEditDescription">Description:</label>
                        <textarea id="eventEditDescription" class="event-edit-textarea" autocomplete="off" rows="4"></textarea>
                    </div>
                    <div class="event-edit-field">
                        <label for="eventEditFilters">Hero Filters (comma-separated):</label>
                        <input type="text" id="eventEditFilters" class="event-edit-input" autocomplete="off">
                    </div>
                    <div class="event-edit-field">
                        <label for="eventEditFactions">Faction Filters (comma-separated):</label>
                        <input type="text" id="eventEditFactions" class="event-edit-input" autocomplete="off">
                    </div>
                    <div class="event-edit-field event-edit-field-full">
                        <label>Sources:</label>
                        <div id="eventSourcesContainer"></div>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button type="button" id="addSourceBtn" class="event-edit-btn">+ Add Source</button>
                            <button type="button" id="removeSourcePairBtn" class="event-edit-btn" style="display: none; background: rgba(244, 67, 54, 0.8);">- Remove Source</button>
                        </div>
                    </div>
                    <div class="event-edit-actions">
                        <button id="eventEditSave" class="event-edit-btn save-btn">Save</button>
                        <button id="eventEditCancel" class="event-edit-btn cancel-btn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Background Music -->
        <audio id="backgroundMusic" loop>
            <source src="" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>

        <div class="sidebar-indicator" id="sidebarIndicator">‚ò∞</div>
    </div>

    <footer>
        <p>&copy; Original Work by Blizzard Entertainment.</p>
    </footer>

    
    <!-- Three.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    
    <!-- GLTF Loader -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <!-- Main Globe Script (ES6 Modules) -->
    <script type="module" src="globe-new.js"></script>
    
    <!-- Event Manager -->
    <script src="js/EventManager.js"></script>
    
    <!-- Sidebar Script -->
    <script src="script.js"></script>
    
    <!-- Initialize Event Manager -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (window.EventManager) {
                const eventManager = new EventManager();
                eventManager.init().then(() => {
                    // Setup event listeners after initialization
                    eventManager.setupEventListeners();
                    
                    // After EventManager loads events, sync with DataModel if GlobeController is ready
                    if (window.globeController && window.globeController.dataModel) {
                        window.globeController.dataModel.events = [...eventManager.events];
                        // Refresh event markers on globe
                        if (window.globeController.globeView) {
                            window.globeController.globeView.refreshEventMarkers();
                        }
                        // Refresh pagination
                        if (window.globeController.uiView) {
                            window.globeController.uiView.setupEventPagination(() => {
                                if (window.globeController.globeView) {
                                    window.globeController.globeView.refreshEventMarkers();
                                }
                            });
                        }
                        console.log('EventManager: Synced events with GlobeController after initialization');
                    }
                });
                window.eventManager = eventManager; // Make it globally accessible
            }
        });
    </script>
</body>
</html>






















